Motivation：startTransitionの現実的なデモを作りたい


何をつくるか
- 編集可能なn個の記事があり、検索画面から事前にインデックスをつけない全文検索ができるアプリ
- 記事をクリックするとエディタ画面で記事が開き、記事が編集可能になる
- レイアウトはserver component demo を参考にする


覚える必要があること
- draft.js
- flexsearch
- tailwind のHeadless UI
- 永続化する場合は永続化の手法も

こだわらないこと
- 新しく使うライブラリの詳細な理解
- UI

これまでの反省
- 全体像がわからないときに不安感があり、調べすぎてしまう場合がある
- 不安にかられている場合、なぞるような読み方しか出来ず、理解が進まない場合が多い（こういうときは大概qiitaとか負荷の低いものばかり読んでいた）

対策
- 不安にかられていることを自覚する。少し手を休めて不安を直視し、原因を探る。
- その上で負荷をかけて理解する
- 不安を消すには結局成功体験を積むしか無いし、いつも成功するような行為をするべき

# 2021-06-17
2021-06-17 18:23:52
ひとまず動かし方がわかったので、詳細を作り込んでいく。
createWithContentで最初から情報を入れたいが、引数のデータ型がよくわからない。stringではなく独自の型が入るが、データをどこかから取り出せるのか？


2021-06-17 20:20:43
不安は「わからない」というより「出来ない」が近いかもしれない。あまり良い抽象化と思えない非直感的なAPIを触ると、全体像の把握が難しくなる。どうやって動いているのかわからない巨大なコードベースを改修する際に、どこから手を付けてよいかわからなくなる感覚。エントリーポイントがどこかを認識することが重要か。（しかし大概そういうことで困るライブラリは、getting startedにエントリーポイントやコアコンセプトの記載がない。）
公式ドキュメントで重要そうな箇所の「あたりをつける」訓練をしよう。30分でこの型のデータをどう用意するかドキュメントから知る

結果：このライブラリの特徴や優位点がわかったが、withContentをどう取得すればよいかわからないまま。「わかって来たぞ」とおもって後半に細かいAPI情報を眺めていたのが計画性がなく、良くなかった。「ここかここかここにあるはず」というあたりをつけることが目的なのだから、それを頭にいれて行うべきだった。
次は10分間ザッピングして、無理そうなら公式ドキュメント以外を見る。それでもわからなければ一度別のライブラリを使ってみる。

2021-06-17 20:56:28
コンポーネントにデータを流し込む方法について引き続き調べる。07分までに見当がつかなければ英語圏を中心に情報を探す。
https://draftjs.org/docs/api-reference-data-conversion/

英語圏の情報を中心に探した。https://stackoverflow.com/questions/35884112/draftjs-how-to-initiate-an-editor-with-content　が探していた回答っぽい。
https://codesandbox.io/s/formik-09x-draftjs-example-forked-isvbi あたりはよく出来たアプリケーションだと思う。動くようになったら参考にして機能を作ろう

教訓：英語版googleで検索する。今回の場合日本の情報が少ないので、日本語で検索->ドキュメント→英語版という流れより、日本語＆英語で検索→ドキュメントがベターだった。これまでだとドキュメントをすべて読みつくすぐらいだったので、途中で中断できたところがよかった。
（英語版と日本語版の検索結果を同時に表示する拡張とかほしい）

2021-06-17 22:09:01
データの流し込みは完成したので、複数のタブをつくり、それらからエディタコンポーネントに情報を渡す形にする。
やること
- タブのUI
- 情報の持ち方を考える
- appの構造をつくる

目標：タブコンポーネントを実装して、mapで入れた情報を表示できるようにする。

結果：Radio Groupを入れるまでで終わった。10分程度で終わるかと思っていたが、インストールを含めると急いでも20分ぐらいはかかる

2021-06-17 22:35:08
タブコンポーネントのUIの根幹はいじらず、データの表示だけ調整する。一時間でeditorまでつなげる
- タイトルと本文を表示する
- データをcontextで管理し、dispatchで更新できるようにする。

終わらなかった。タイトルと本文を表示するまでは終わったが、contextでの管理までいかなかった。
色気をだして、UIを調整しようとしてしまったせい。
context自体は10分で終わるだろう。次の時間でエディターへ情報を渡すまで完成させられるだろう。
TODO: 記事コンポーネント背景を白抜きにして視認性を高める　or shadow
TODO: 現状記事コンポーネント内部のbgはselect時に背景と同じ色になってしまっている。色を変える。
TODO:　エディタ画面は白抜きにする　幅固定に

2021-06-17 23:26:49
contextで記事管理、editorに選択された情報を渡し、内容を表示させる。
> なぜContextか？あとで検索するときにデータを使いまわしたいから。
- ArticleContextコンポーネントをつくる
- editorとsidebarを子にもつコンポーネントで読み込む。

内容表示まで終わらせた。次は変更を反映させる。一つ一つsetStateを渡すのも馬鹿らしいので、reducerを持つように変更しよう。



休憩

TODO: タブをoverflow:hiddenにして、小説本文を3行とかまで表示するようにする。現在の70文字まで表示は見た目が残念
TODO: アクティブなタブだけ本文が表示されるように。今だと11個が画面に入り切らない
2021-06-18 01:35:02
エディタにpropsを渡してもそのままではエディタが更新されないので、hooksも更新しなければならない。
- github　レポジトリをつくる
- useEffectで更新させる
進まず。寝る


# 2021-06-18
昨日、三時間で簡単なUIとエディタに情報を渡すことまで行った。次に、編集を記憶する必要がある。選択した記事を表示する際に、これまで表示していた記事を反映することを考えたが、useEffectで全文検索で更新を即座に検知してくれるなら逐次更新にする必要がある。（startTransitionポイント！）
データの持ち方について多少考えてみたところ、
要件
- stringで持つことはできない: リッチテキストが保存されない
- 逐次更新にする必要がある：


- ひとつの巨大なオブジェクトへのマージはコストが高い印象があり、筋の悪い実装をすることになる予感がある。だが筋のいい代案がみつからず（文章のstateを11個もつのはないし、回収コストが高い。加えて）
- 簡単なPOCだから気軽にいっていいだろうか。
- 「わざと失敗してみる」と考える
ブランチをかえることで、心理的抵抗はへるだろうか。（）

2021-06-19 23:32:54
三十分でデータの変更までやる。
わかったこと
convertToRaw関数はjsオブジェクトへの変換で、どうにも全文検索用にtextへと変換するプロパティがない？`ContentState.getPlainText()か？
